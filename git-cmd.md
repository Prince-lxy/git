# Git 命令
> Git 方法论。

## Contents / Mind mapping
- **1 对仓库的操作**
  - **1-1 仓库的创建**
  - **1-2 仓库的删除**
- **2 对文件的操作**
  - **2-1 查看文件状态**
  - **2-2 工作区文件操作**
  - **2-3 暂存区文件操作**
  - **2-4 HEAD区文件操作**
- **3 对分支的操作**
  - **3-1 分支的创建与删除**
  - **3-2 分支管理**
- **4 对远程仓库的操作**
  - **4-1 远程仓库的添加与删除**
  - **4-2 远程仓库管理**
  - **4-3 对远程分支的操作**

---

### 1 对仓库的操作

对仓库的操作就是对仓库目录下 `.git/` 文件夹的整体操作。

#### 1-1 仓库的创建

在现有的目录下初始化仓库：
```
git init
```

克隆已经存在的仓库：
```
git clone <url> [<repo local name>]
```

#### 1-2 仓库的删除

想要删除某个 Git 仓库，只需要将该仓库目录下的`.git/`目录删除即可：
```
cd <repo dir>
rm -rf .git/
```



### 2 对文件的操作

对仓库中文件的操作，主要基于 Git 文件在三个状态（提交、暂存和修改）中不断变化而产生。

#### 2-1 查看文件状态

查看目录下所有文件当前的状态:

```
git status
```

简要信息输出：

```
git status -s
```

在简要信息中，通过以下标记来表达文件目前的状态：

|标记|含义|
|--|--|
|??|未跟踪文件|
|A|新添加到暂存区|
|左M|文件被修改后已经放入暂存区|
|右M|文件被修改后还未放入暂存区|
|双M|文件修改并放入暂存区后再一次被修改|

一般仓库中有一些文件不想被 Git 仓库管理，同时也不想总是出现在未被跟踪的列表中，我们可以将该文件加入 `.gitignore` 文件中，该文件具有以下规则：

- 所有空行或者 `#` 开头的行都会被忽略
- 可以使用适用于shell的简化版正则表达式
- `/` 在模式匹配开头表示仅匹配本目下的对应文件，不去子目录中匹配
- `/` 在模式匹配结尾表示整个目录
- `!` 在模式匹配开头表示取反

#### 2-2 工作区文件操作

工作区中对文件的增删改都不需要特定的 Git 命令。

恢复工作区中文件的错误删改操作：

```
git checkout -- <file>
```

#### 2-3 暂存区文件操作

在将文件彻底提交到历史记录中之前，我们需要将工作区中的对应文件先加入到暂存区（也叫 index 区域），只有暂存区中的文件才有资格被提交到仓库，这样使得工作区内部文件修改更具有灵活性，需要提交的文件可以在众多被修改的文件中选出来。

将文件加入暂存区：
```
git add <file>
```

将文件移除暂存区：
```
git rm --cached <file>
```

如果文件加入暂存区后又进行了修改，需要再次通过 `git add <file>` 命令将文件加入暂存区。

#### 2-4 HEAD区文件操作

查看提交历史：

```
git log
```

增加提交：

```
# 交互式提交
git commit

# 直接提交
git commit -m <message>
```

如果从上一次提交后还没有任何修改被加入的暂存区，可以通过下面这个命令修改上一次提交信息；如果在上次提交后有新的修改被加入到暂存区中，下面这个命令会连通这次新的修改也一起加入到新的提交中：

```
git commit --amend
```

撤销提交：

```
# 撤销提交，保留暂存区修改，保留工作区修改（移动 HEAD 指针指向父提交 HEAD^）
git reset --soft HEAD^

# 撤销提交，撤销暂存区修改，保留工作区修改（用 HEAD^ 提交覆盖暂存区）
git reset HEAD^

# 撤销提交，撤销暂存区修改，撤销工作区修改（用 HEAD^ 提交覆盖暂存区和工作区）
git reset --hard HEAD^
```



### 3 对分支的操作

由于快照之间以链表的方式存储，通过新的快照可以找到旧的快照，每一个快照都具有很强的独立性，因此 Git 中的多分支结构具有相当的灵活性，使用起来非常高效。

#### 3-1 分支的创建与删除

创建分支：

```
git branch <branch name>
```

删除分支：

```
#分支没有新的提交：
git branch -d <branch name>

#分支存在新的提交：
git branch -D <branch name>
```

#### 3-2 分支管理

查看分支：

```
git branch
```

切换分支：

```
git checkout <branch name>
```

合并分支：

```
git merge <branch name>

git rebase <base branch name>
```

解决合并分支时产生的冲突：
```
1. 根据提示手动调整冲突文件
2. 将冲突文件加入暂存区
3. git commit
```



### 4 对远程仓库的操作

对远程仓库的操作，实际上就是在操作远程分支与本地分支，核心还是分支操作。

#### 4-1 远程仓库的添加与删除

添加远程仓库：

```
git remote add <remote name> <url>
```

删除远程仓库：

```
git remote remove <remote name>
```

#### 4-2 远程仓库管理

查看远程仓库：

```
git remote -v

git remote show <remote name>
```

重命名远程仓库：

```
git remote rename <remote name> <new name>
```

#### 4-3 对远程分支的操作

由于我们的本地的仓库通常是通过 git clone 命令克隆远程仓库得到的，该命令会默认在本地生成一个名为 origin 的远程仓库，并将远程仓库中的 origin/master 分支克隆到本地，并生成同名分支 master ，同时将二者绑定，以至于我们使用 pull 和 push 命令都不需要特别指定远程分支的具体内容。

获取远程仓库的指定分支的更新，并建立一个本地分支来存放:

```
git fetch <remote name> <remote branch name>:<local branch name>
```

获取远程仓库指定分支的更新，并与本地分支合并：

```
git pull <remote name> <remote branch name>:<local branch name>
```

推送本地分支的更新到远程仓库（如果省略本地分支名，远程分支将会被删除；如果远程分支不存在将会被创建）：

```
git push <remote name> <local branch name>:<remote branch name>
```
